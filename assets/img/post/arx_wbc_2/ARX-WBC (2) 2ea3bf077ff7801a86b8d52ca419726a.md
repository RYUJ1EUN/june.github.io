# ARX-WBC (2)

date: 2025ë…„ 12ì›” 9ì¼
slug: arx-wbc-attack-paper-2
author: June
status: Private
tags: Paper, WBC
type: Post

<aside>
ğŸ“š

**[MAIN]** Alex Biryukov, Baptiste Lambin, and Aleksei Udovenko.
â€Cryptanalysis of arx-based white-box implementations.â€
IACR Transactions on Cryptographic Hardware and Embedded Systems, 2023(3):97135, 2023.

**[Sub 1]** AdriÃ¡n Ranea, Joachim Vandersmissen, and Bart Preneel.
â€Implicit white-box implementations: White-boxing arx ciphers.â€
In Annual International Cryptology Conference, pages 3363. Springer, 2022.

**[Sub 2]** AdriÃ¡n Ranea and Bart Preneel.
â€On self-equivalence encodings in white-box implementations.â€
Cryptology ePrint Archive, Paper 2020/1325, 2020.

</aside>

# Birykovâ€™s Attack

## Black-box Decomposition of an ARX Round

### Affine encoding

I/O encodingì´ ëª¨ë‘ affineì¼ ë•Œ SEê°€ ì•„ë‹ˆì–´ë„ ì„±ë¦½í•˜ëŠ” ê³µê²© ê¸°ë²•

ê³µê²© ëŒ€ìƒ: $\mathbb{O}=B\circ S\circ A$

![affine_round_decompo_1.png](affine_round_decompo_1.png)

ì „ëµ: $\mathbb{O}(x)=B\circ S\circ A(x)=z$ë¥¼  $\mathbb{O}(x,y)=(B\circ S\circ A(x),\ y)=(z,y)$ë¡œ ë°”ê¿ˆ

ë¹„ì„ í˜• ì—°ì‚°ì€ $S$ì—ì„œë§Œ ì´ë¤„ì§€ê³ , ì„ í˜• ì—°ì‚°ë¶€ëŠ” encodingì— í¡ìˆ˜ì‹œí‚¬ ìˆ˜ ìˆìŒ

ì„ í˜• ì—°ì‚°ë¶€ë¥¼ ì¡°ì •í•˜ì—¬ ë¹„ì„ í˜• ì—°ì‚°ì´ $z$ì—ë§Œ ì˜í–¥ì„ ë¯¸ì¹˜ë„ë¡ ì¡°ì •í•˜ë©´, ë¹„ì„ í˜• ì—°ì‚°ì€ $x\boxplus y\mapsto z$ë¡œë§Œ ì´ì–´ì§€ë©° $y\mapsto y$ì— ì˜í–¥ì´ ì—†ìŒ

![image.png](image.png)

1. **Locating linear bits**
    
    *Encoding ë¶€ì—ì„œ ì„ í˜• ë¶€ë¶„ê³µê°„ì„ êµ¬ë³„í•¨ìœ¼ë¡œì¨ êµ¬ì¡°ë¥¼ ë‹¨ìˆœí™”í•˜ê³  ì¶”í›„ ìˆ˜í–‰ë  ê³µê²©ì´ ì ìš©ë  ë²”ìœ„ë¥¼ ì¶•ì†Œí•¨*
    
    ![image.png](image%201.png)
    
    ARX roundë¥¼ $S$-layerì— affine encoding $(A,B)$ë¥¼ ì¶”ê°€í•œ í˜•íƒœë¡œ ë³¼ ë•Œ, encodingì„ ì œì™¸í•œ ë¼ìš´ë“œ í•¨ìˆ˜ê°€ $S(x\| y)=(x\boxplus y\|y)$ë¼ëŠ” ì„±ì§ˆì„ í™œìš©í•¨
    
    $\mathbb{O}$ì˜ $A,B$ëŠ” affine mapì´ë¯€ë¡œ $S$ì˜ basis transformë§Œ ìˆ˜í–‰í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³¼ ìˆ˜ ìˆìŒ
    
    â‡’  $n+1$ ê°œ ì„ í˜• ê´€ê³„ë¥¼ ì°¾ì•„ basis transformationì„ í†µí•´ ë¶„ì„í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°ë¡œ ì „í™˜
    
    $x, y$ ì¡°ì •
    
    - $x:\ (x_{n-1}, x_{n-2}, ...\,, x_{1}, {\color{red} x_0})\to (x_{n-1}, x_{n-2}, ...\,, x_{1})$
    - $y:\ (y_{n-1}, y_{n-2}, ...\,, y_{0})\to ({\color{red}y_n=x_0\oplus y_0},\; y_{n-1}, y_{n-2}, ...\,, y_{0})$
    - $c_1$ (unknown with $A$) $:\ carry(x'_0, y'_0)=carry({\color{red} y'_n}\oplus y'_0,\ y'_0)$
    
    $\pi_x, \pi_z$: affine projection maps s.t.
    
    $$
    \mathbb{O}'=\pi_z\circ\mathbb{O}\circ \pi_x^{-1}
    $$
    
    (*ì¼ë°˜ì ìœ¼ë¡œ ì •ì˜í•˜ëŠ” projection  $\pi:V^n\to V$ì™€ ë‹¤ë¦„* )
    
    Then, 
    
    $$
    \mathbb{O}=\pi_z^{-1}\circ\mathbb{O}' \circ \pi_x=(\pi_z^{-1}\circ B')\circ S\circ (A'\circ \pi_x)
    $$
    
    ì´ë•Œ, $A', B'$ì€  $\mathbb{O}'= B'\circ S\circ A' =\pi_z\circ\mathbb{O}\circ \pi_x^{-1}$ê°€ ì„±ë¦½í•˜ëŠ” affine encoding
    
    - $\pi_x$ì˜ êµ¬ì¡°ë¥¼ ê³ ë ¤í•  ë•Œ ì—­í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•Šì§€ë§Œ, ì§ê´€ì  í‘œê¸°ë¥¼ ìœ„í•´ inverse í‘œê¸°í•¨
        
        ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ê³µê²©ì— ëŒ€í•˜ì—¬ projection mapì˜ ì ìš©ê³¼ branchì˜ ë¶„ë¦¬ëŠ” 2ê°œì˜  layerë¡œ ë°”ë¼ë´ì•¼ í•¨. projection mapì— ë”°ë¥¸ $\mathbb{O}'$ì˜ í‘œí˜„ì€ ìˆ˜í•™ì ìœ¼ë¡œ ì—„ë°€í•˜ì§€ ì•Šìœ¼ë‚˜ ì•„ë˜ì™€ ê°™ì´ ì´í•´í•  ìˆ˜ ìˆìŒ
        
        $\pi_x, \pi_z$ì˜ ì˜ë¯¸
        
        Line 7 $B$: $V$ì˜ ì˜ê³µê°„ì„ ê¸°ì €ë¡œ ê°–ëŠ” ê³µê°„ì˜ í–‰ë ¬ í‘œí˜„
        
        - ì„ í˜• ë¶€ë¶„ ê³µê°„ì˜ ê¸°ì € = non-linear part í•„í„°ë§
        - Line 6ì—ì„œ ëª¨ì€ ê·¸ë˜í”„ ìœ„ ì ë“¤ì´ ê³µí†µì ìœ¼ë¡œ ë§Œì¡±í•˜ëŠ” $n+1$ê°œì˜ ì„ í˜• ê´€ê³„ë¥¼ ì°¾ì•„ì•¼ í•¨
            
            $$
            \ker(V)=\{ \lambda: V\circ \lambda =0 \}\\[1em]
            
            \dim(\ker V)=\underset{\dim V}{\underbrace{(2N+1)}}\;-\underset{(\text{rank} V)\,=\,(\# \text{ pivot columns})}{\underbrace{\;[\,2N+1-(n+1)\,]\;}}=
            \underset{\text{Nullity } V}{\underbrace{n+1}}
            $$
            
        - $V$ì˜ ì˜ê³µê°„: $V$ì˜ ëª¨ë“  í–‰ê³¼ ìˆ˜ì§, ì„ í˜• ì—°ì‚° ê²°ê³¼ = 0
            
            $$
            \begin{aligned}
            \left< \lambda_X, X \right>
            \oplus
            \left< \lambda_Z, Z \right>
            \oplus \lambda_c
            &= \left< \left( \lambda_X \| \lambda_Z \| \lambda_c \right) ,\ 
            \left( X \| Z \| 1 \right) \right>\\
            &= 0
            \end{aligned}\\[.5em]
            
            \implies \left( \lambda_X \| \lambda_Z \| \lambda_c \right) \perp
            \left( X \| Z \| 1 \right)
            $$
            
        
        ì¦‰,
        
        $$
        x^{(i)}_{(1\times N)},\quad \mathbb{O}(x^{(i)})=y^{(i)}_{(1\times N)}, \quad 
        {\pi_x^{(i)}}_{\!\!(N\times 1)}, \quad 
        {\pi_z^{(i)}}_{\!\!(N\times 1)}
        $$
        
        ì— ëŒ€í•˜ì—¬
        
        $$
        \underset{\qquad\qquad\qquad\qquad\;\;\;(N+\epsilon)\times(2N+1)\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!}{\begin{pmatrix}
        x^{(1)} & \mathbb{O}(x^{(1)}) & 1\; \\[-.3em]
        \vdots & \vdots & \vdots\; \\[.2em]
        x^{(i)} & \mathbb{O}(x^{(i)}) & 1\; \\[-.3em]
        \vdots & \vdots & \vdots\; \\[.2em]
        x^{(N+\epsilon)} & \mathbb{O}(x^{(N+\epsilon)}) & 1\; 
        \end{pmatrix}}
        
        \underset{\qquad\qquad\qquad\qquad(2N+1)\times(n+1)\!\!\!\!\!\!\!\!\!\!\!\!}{
        \begin{pmatrix}
        \pi_x^{(1)} & \!\!\!\!\cdots\!\!\!\! & \pi_x^{(i)} & \!\!\!\!\cdots\!\!\!\! & \pi_x^{(n+1)} \\[1.3em]
        \pi_z^{(1)} & \!\!\!\!\cdots\!\!\!\! & \pi_z^{(i)} & \!\!\!\!\cdots\!\!\!\! & \pi_z^{(n+1)} \\[1.3em]
        c_y^{(1)} & \!\!\!\!\cdots\!\!\!\! & c_y^{(i)} & \!\!\!\!\cdots\!\!\!\! & c_y^{(n+1)}
        \end{pmatrix}}
        
        =
        
        \underset{\qquad\qquad\quad(N+\epsilon)\times(n+1)\!\!\!\!\!\!\!\!\!\!\!\!}{
        \begin{pmatrix}
        0 & \!\!\!\cdots\!\!\! & 0 & \!\!\!\cdots\!\!\! & 0 \\[-.5em]
        \vdots & & \vdots & & \vdots \\
        
        0 & \!\!\!\cdots\!\!\! & 0 & \!\!\!\cdots\!\!\! & 0 \\[-.5em]
        \vdots & & \vdots & & \vdots \\
        0 & \!\!\!\cdots\!\!\! & 0 & \!\!\!\cdots\!\!\! & 0
        \end{pmatrix}}
        $$
        
        $$
        \begin{aligned}
        \pi^{(i)}_{x1} x^{(i)}_1 + \cdots + \pi^{(i)}_{xN} x^{(i)}_N
        \;& + \;
        \pi^{(i)}_{z1} z^{(i)}_1 + \cdots + \pi^{(i)}_{zN} z^{(i)}_N + c_y^{(i)}=0
        
        \\[1em]
        
        \pi^{(i)}_{x1} x^{(i)}_1 + \cdots + \pi^{(i)}_{xN} x^{(i)}_N
        \;& = \;
        \pi^{(i)}_{z1} z^{(i)}_1 + \cdots + \pi^{(i)}_{zN} z^{(i)}_N + c_y^{(i)}
        \end{aligned}
        \\[1.5em]
        
        \qquad\implies 
        x^{(i)}_{(1\times N)}{\pi_x^{(i)}}_{\!\!(N\times 1)} =\,  y^{(i)}_{(1\times N)}
        {\pi_z^{(i)}}_{\!\!(N\times 1)}
        
        \;\;\left(\text{set }\pi_z^{(i)}\leftarrow \pi_z^{(i)}\oplus(0^{N-1}\|c_y^{(i)})\right)
        $$
        
        ë‹¬ë¦¬ í‘œí˜„í•˜ë©´
        
        $$
        \underset{\qquad\qquad(N+\epsilon)\times(2N+1)\!\!\!\!}{\begin{pmatrix}
        | & | & |\; \\[.2em]
        X^T & \!\!(\mathbb{O}(X))^T\!\! & 1\; \\[.1em]
        | & | & |\; 
        \end{pmatrix}}
        
        \underset{\qquad(2N+1)\times(n+1)\!\!\!\!}{
        \begin{pmatrix}
        - & \!\!\pi_X^T\!\! & - \\[1.3em]
        - & \!\!\pi_Z^T\!\! & - \\[1.3em]
        - & \!\!c_Y^T\!\! & -
        \end{pmatrix}}
        
        =
        
        X^T\pi_X^T +(\mathbb{O}(X))^T\pi_Z^T+c_Y^T=\vec 0
        $$
        
        $$
        X^T \pi_X^T =(\mathbb{O}(X))^T\pi_Z^T + c_Y^T
        $$
        
        $$
        \begin{aligned} 
        
        \pi_X X &= \pi_Z(\mathbb{O}(X))
        
        \quad\left(\text{set }\pi_Z\leftarrow \pi_Z\oplus(0^{n-1}\|c_y^T)\right)
        
        \\[1em]
        
        \pi_X (X) &= \pi_Z\circ \mathbb{O}(X)
        
        \\[1em]
        
        X = \pi_X\circ (\pi_X)^{-1} (X) &= \pi_Z\circ \mathbb{O}\circ (\pi_X)^{-1} (X)
        
        \end{aligned}
        $$
        
        $\mathbb{O}'$ì— ì˜í•´ right branch ì •ë ¬ì´ ì™„ë£Œëœ í›„ ë‚¨ì€ êµ¬ì¡°ë¡œ $y$ê°€ left branchì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì˜ì—­ì€ ë‹¤ìŒê³¼ ê°™ìŒ
        
        - $A\circ\pi_x$
            - $A'$ì—ì„œ left branchë¡œ ì´ì–´ì§€ëŠ” ì—°ì‚° $A_1$
            - $n+1$ë¹„íŠ¸ $y$ì˜ $n+1$ë²ˆì§¸ ë¹„íŠ¸ $x_0$ê³¼ $0$ë²ˆì§¸ ë¹„íŠ¸ $y_0$ì˜ ì¸ì½”ë”© í›„ ê°’ì¸ $x_0', y_0'$ì— ëŒ€í•œ carry bit $c_1=carry(x_0', y_0')$
            - $S$-layer ì—°ì‚°ì— ì‚¬ìš©ë  $n-1$ë¹„íŠ¸ $y=(y_{n-1},\,...\,,y_2,y_1)$ì˜ ì¸ì½”ë”© í›„ ê°’ $A_2(y)$
        - $\pi_z\circ B$
            - $B'$ì—ì„œ left branchë¡œ ì´ì–´ì§€ëŠ” ì—°ì‚° $A_3$
        
        ë˜í•œ, ì •ë ¬ì´ ì™„ë£Œëœ í›„ $x$ì— ëŒ€í•œ ì¸ì½”ë”©ìœ¼ë¡œ $A'$ì—ì„œì˜ $B_1$ê³¼ $B'$ì—ì„œì˜ $B_2$ë¥¼ ê³ ë ¤í•´ì•¼ í•¨
        
        ![affine_round_decompo_1.png](affine_round_decompo_1%201.png)
        
        Here, $A_1, A_2, A_3, B_1, B_2$ are unknown affine maps, $c_1$ is first carry bit of the original $n$-bit addition, expressible as $c_1(y) = \left<\alpha, y\right>\cdot\left<\beta, y\right>$ for some $\alpha, \beta\in\mathbb{F}_2^{n+1}$.
        
    
    How to find $\pi_x, \pi_z$?
    
    **Algorithm 1: Recovering input/output matching affine subspaces**
    
    - **Input:** oracle $\mathbb{O}$ implementing bijective modular addition with affine encodings
    - **Output:** affine maps $\pi_X, \pi_Z$ such that $\mathbb{O}' = \pi_z \circ \mathbb{O} \circ \pi_x^{-1}$ is such that $\mathbb{O}'(x\|y) = (z\|y)$ for all $(x, y) \in \mathbb{F}_2^{n-1} \times \mathbb{F}_2^{n+1}$, with $z \in \mathbb{F}_2^{n-1}$
        1. **for** $i \in \{0, \dots, N + \epsilon - 1\}$ **do** `N+eê°œ ì…ì¶œë ¥ ìŒì— ëŒ€í•˜ì—¬`
        2. $\quad x^{(i)} \xleftarrow{\$} \mathbb{F}_2^N$    `Në¹„íŠ¸ ì˜¤ë¼í´ ì…ë ¥ x ìƒì„±`
        3. $\quad y^{(i)} \leftarrow \mathbb{O}(x^{(i)})$   `ì˜¤ë¼í´ ì¶œë ¥ y ìƒì„±`
        4. $\quad v^{(i)} \leftarrow (x^{(i)} \| y^{(i)} \| 1)$   `ê·¸ë˜í”„ ìœ„ì˜ ì  (x,y)ë¡œ ë³¼ ìˆ˜ ìˆìŒ`
        5. **end for**
        6. $V \leftarrow$ matrix with rows $\{v^{(i)}\}_i$    `ê° í–‰ ë²¡í„°ê°€ vì¸ í–‰ë ¬ V êµ¬ì„±`
        7. $B \leftarrow \text{basis}(\ker V)$ so that $V \times B = 0$    `ker Vê°€ basisì¸ B ìƒì„±`
        8. $(\pi_x, \pi_z, c_y) \leftarrow B^T$, where $\pi_x, \pi_z \in \mathbb{F}_2^{(n+1) \times N}$, $c_y \in \mathbb{F}_2^{(n+1) \times 1}$
        `ê° í–‰ì´ mapì´ ë˜ë„ë¡ transpose B ê³„ì‚°`
        9. **return** $\pi_x, \pi_z\leftarrow \pi_z\oplus(0^{n-1} \| c_y^T)$
        `affine map ìƒìˆ˜í•­ì„ ë³´ì •í•œ zì˜ affine mapì„ pi_zë¡œ ë°˜í™˜`
    
    êµ¬í•˜ë ¤ëŠ” projection mapì€ $n-1$ë¹„íŠ¸ $x$ì™€ $n+1$ë¹„íŠ¸ $y$ë¥¼ $n+1$ë¹„íŠ¸ $y$ë¡œ ë³´ë‚´ëŠ” mapì´ë¯€ë¡œ $\pi:\mathbb{F}_2^{N}\to \mathbb{F}_2^{n+1}$ì¼ ê²ƒì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìœ¼ë©° $\mathbb{O}$ì˜ $S$-layerë¥¼ êµ¬ì„±í•œ ë¹„ì„ í˜• ì—°ì‚°ì€ $\ker V$ì— ì†í•´ ë‚˜íƒ€ë‚˜ì§€ ì•Šê²Œ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒí•  ìˆ˜ ìˆìŒ
    
2. **Triangularization of the outer affine maps (left branches)**
    
    **Proposition 3.** Let $\Delta x = (\dots \parallel 0^k), \Delta y = 0^n$. Let $Z$ denote the set of all possible output differences $\Delta z$ of $z = x \boxplus y$. Then, $\text{rank } Z \leq n - k$. Furthermore, if $\text{rank } Z = n - k$, then $(\Delta x)_k = (\Delta z)_k = 1$, i.e., $\Delta x$ and $\Delta z$ both have shape $(\dots \parallel 1 \parallel 0^k)$.
    
    Explain) Let $\Delta x_i = x_i \oplus x'_i,\ \Delta y_i = y_i \oplus y'_i=0$. Then, $\Delta z_i = (x_i \boxplus y_i)\oplus (x'_i \boxplus y'_i)$
    
    $$
    \begin{aligned} 
    \Delta z_i & 
    =(x_{i,n-1}\oplus y_{i,n-1}\oplus c_{i,n-1},..., x_{i,0}\oplus y_{i,0}\oplus c_{i,0})\\&
    \qquad\oplus(x'_{i,n-1}\oplus y'_{i,n-1}\oplus c'_{i,n-1},..., x'_{i,0}\oplus y'_{i,0}\oplus c'_{i,0})\\& 
    
    =(x_{i,n-1}\oplus x'_{i,n-1}\oplus  c_{i,n-1}\oplus c'_{i,n-1},\;...\,, \;x_{i,0}\oplus x'_{i,0}\oplus c_{i,0}\oplus c'_{i,0})\\&
    
    =(\Delta x_{i,n-1}\oplus  \Delta c_{i,n-1},\;...\,, \;\Delta x_{i,0}\oplus \Delta c_{i,0})\qquad\footnotesize(\text{Let }\Delta c_{i,j}= c_{i,j}\oplus c'_{i,j})
    \end{aligned}
    $$
    
    Assume that $\Delta x_{i,j}\neq 1$ (i.e., $\Delta x_{i,j}=0$).
    
    Because $\Delta x_{i,j-1}=0, \Delta y_{i,j-1}=0$  implies  $(x_{i,j-1}\boxplus y_{i,j-1}) = (x'_{i,j-1}\boxplus y'_{i,j-1})$,
    
    $\Delta c_{i,j}=0$, 
    
    Then, $\Delta z_{i,j}=0 \implies \text{rank } Z$ canâ€™t be $n-k$.
    
    $\therefore$  If $\text{rank }Z=n-k$  then  $\Delta x_{i,k}=1$ and also $\Delta z_{i,k}=1$
    
    **Algorithm 2: Triangularization of the outer maps on the left branch**
    
    - **Input:** oracle $\mathbb{O}$ implementing bijective modular addition with partially recovered affine encodings (Subsection 6.1)
    - **Output:** affine maps $\pi_x, \pi_z$ such that $\mathbb{O}' = \pi_z \circ \mathbb{O} \circ \pi_x^{-1}$ matches structure from Figure with lower triangular $T_1, T_2$
        
        ![image.png](image%202.png)
        
    - **Complexity:** $\mathcal{O}(n^2)$ queries, $\mathcal{O}(n^4)$ time
        1. $\mathbb{O}_0 \leftarrow \mathbb{O}$
        2. **for** $k \in \{0, \dots, n - 2\}$ **do**
        3.      **repeat** `try n+e time`
        4. $\quad \quad \Delta x \overset{\$}{\leftarrow} (*^{n-1-k} \parallel 0^{n+1+k})$
        5. $\quad \quad Z \leftarrow \{ \Delta \mathbb{O}_k (\Delta x) \mid n + \epsilon \text{ times} \}$
        6.      **until**  $\text{rank } Z = n - 1 - k$
            
                 `It is sufficient to query each of n-1-k unit differences`
            
        7.      solve $Z \times \alpha = (1, \dots, 1)^T$  for $\alpha = (*^{n-1-k} \parallel 0^{n+1+k})$
        8. $\quad \pi_z \leftarrow$ a linear map such that
            
                 $(\pi_z(z))_{n+1+k} = \langle \alpha, z \rangle, (\pi_z(z))_i = z_i$ for $i > n + 1 + k$
            
        9. $\quad \beta \leftarrow (\pi_z(\Delta \mathbb{O}_k(e_i))_{n+1+k} \mid n + 1 + k \leq i < 2n) \parallel 0^{n+1+k}$
        10. $\quad \pi_x \leftarrow$ a linear map such that
            
                 $(\pi_x(x))_{n+1+k} = \langle \beta, x \rangle, (\pi_x(x))_i = x_i$ for $i > n + 1 + k$
            
        11. $\quad \mathbb{O}_{k+1} \leftarrow \pi_z \circ \mathbb{O} \circ \pi_x^{-1}$
        12. **end for**
        13. **return**  $\mathbb{O}_{n-1}$

### Sparse Quadratic-Affine encoding