{% comment %}
  Unified work/experience entry renderer for both RenderCV and JSONResume formats
  Handles both:
  - RenderCV: company, position, start_date, end_date, location, url, summary, highlights
  - JSONResume: name, position, startDate, endDate, location, url, summary, highlights
{% endcomment %}

<ul class="card-text font-weight-light list-group list-group-flush">
  {% assign last_group = "" %}
  {% for entry in entries %}
    {% comment %} 그룹화의 기준을 location으로 설정 {% endcomment %}
    {% assign current_group = entry.location | default: "" %}

    {% comment %} 날짜 처리 로직 유지 {% endcomment %}
    {% assign s_date = entry.start_date | default: entry.startDate %}
    {% assign e_date = entry.end_date | default: entry.endDate %}
    {% assign startYear = s_date | split: '-' | first %}
    {% assign endYear = e_date | split: '-' | first | default: 'Present' %}
    {% assign full_date_range = startYear | append: ' - ' | append: endYear %}

    <li class="list-group-item" style="border: none; {% if current_group != last_group and current_group != "" %}border-top: 1px solid var(--global-divider-color) !important; padding-top: 2rem;{% else %}padding-top: 0;{% endif %} padding-bottom: 1.5rem;">
      <div class="row">
        <div class="col-xs-2 col-sm-2 col-md-2 text-center date-column">
          {% if current_group != last_group and current_group != "" %}
            <table class="table-cv">
              <tbody>
                <tr>
                  <td>
                    <span class="badge font-weight-bold danger-color-dark text-uppercase align-middle" style="min-width: 75px">
                      {{ full_date_range }}
                    </span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p class="location">
                      <i class="fa-solid fa-location-dot iconlocation"></i> {{ current_group }}
                    </p>
                  </td>
                </tr>
              </tbody>
            </table>
            {% assign last_group = current_group %}
          {% endif %}
        </div>

        <div class="col-xs-10 col-sm-10 col-md-10 mt-2 mt-md-0">
          {% assign position_title = entry.position %}
          {% if entry.url %}
            <h6 class="title font-weight-bold">
              <a href="{{ entry.url }}">{{ position_title }}</a>
            </h6>
          {% elsif position_title %}
            <h6 class="title font-weight-bold">{{ position_title }}</h6>
          {% endif %}

          {% assign company_name = entry.name | default: entry.company | default: entry.organization %}
          {% if company_name %}
            <h6 class="font-weight-bold" style="font-size: 0.95rem">{{ company_name }}</h6>
          {% endif %}

          {% if entry.summary %}
            <h6 style="font-size: 0.95rem; font-style: italic">
              {{ entry.summary | markdownify | remove: '<p>' | remove: '</p>' }}
            </h6>
          {% endif %}

          {% if entry.highlights %}
            <ul class="items">
              {% for item in entry.highlights %}
                <li>
                  <span class="item">{{ item | markdownify | remove: '<p>' | remove: '</p>' }}</span>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </div>
    </li>
  {% endfor %}
</ul>