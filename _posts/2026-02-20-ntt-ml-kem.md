---
layout: post
title: "NTT ML-KEM"
date: 2025-12-16
description: "NTT(Number Theoretic Transform) for ML-KEM, ML-DSA"
tags: [MATH, PQC, Cryptography]
categories: [Study]
---



ğŸ“š **[MAIN]** Liang, Zhichuang, and Yunlei Zhao. "Number theoretic transform and its applications in lattice-based cryptosystems: A survey."Â *arXiv preprint arXiv:2211.13546*Â (2022).  
ğŸ“š **[Sub 1]** Pollard, John M. "The fast Fourier transform in a finite field."Â *Mathematics of computation*Â 25.114 (1971): 365-374.  
ğŸ“š **[Sub 2]** Agarwal, Ramesh C., and C. Sidney Burrus. "Number theoretic transforms to implement fast digital convolution."Â *Proceedings of the IEEE*Â 63.4 (2005): 550-560.  
ğŸ“š **[Sub 3]** FÃ¼rer, Martin. "Faster integer multiplication."Â *Proceedings of the thirty-ninth annual ACM symposium on Theory of computing*. 2007.  
ğŸ“š **[Sub 4]** Fraleigh, John B.Â *A first course in abstract algebra*. Pearson Education India, 2003.

---








### ML-KEM(CRYSTALS-Kyber)

Kyber is an IND-CCA secure MLWE-based KEM from the lattice-based cryptography suite called â€œCryptographic Suite for Algebraic Lattices (CRYSTALS)â€.

The Kyber uses a ring $\mathbb{Z}_q[x]/(x^n + 1)$ with $n = 256$ and $q = 3329$, which no longer satisfy $q \equiv 1 \pmod{2n}$, but $q \equiv 1 \pmod{n}$. 

### Preliminary

#### Primitive and Principal Root of Unity

Define $\psi$ is the primitive $k$-th root of unity in ring $R$ 

$\iff$ $\psi^k=1$, and $\psi^i\neq 1,\; i=1,2,\ ...\,,\ k-1$. 

(i.e., $k$ is the least positive integer s.t. $\psi^k = 1$)

##### Cyclotomic polynomial

$n$-th cyclotomic polynomial $\phi_n(x)$ëŠ” primitive $n$-th roots of unityë“¤ë§Œì„ ê·¼ìœ¼ë¡œ ê°–ëŠ” ìµœê³ ì°¨í•­ ê³„ìˆ˜ê°€ 1ì¸ ë‹¤í•­ì‹ì„

$$
\phi_n(x)=\prod_{1\le k<n,\\[1em]  \gcd(k,n)=1}(x-e^{2\pi ki/n})
$$

##### 2n-th cyclotomic polynomial

Let $n$ be a power of two, then $x^n +1$ is the $2n$-th cyclotomic polynomial.

ì¦‰, $x^n +1$ì€ primitive $2n$-th roots of unityë“¤ë§Œì„ ê·¼ìœ¼ë¡œ ê°–ëŠ” ë‹¤í•­ì‹ì„

#### Convolution

- **Cyclic** convolution
    
    Consider $\boldsymbol{c} = \boldsymbol{a} \cdot \boldsymbol{b} \in \mathbb{Z}_q[x]/(x^n - 1)$, then 
    
    $$
    \boldsymbol{c} = \sum_{k=0}^{n-1} c_k x^k,\\[.5em]
    \text{where  } c_k = \sum_{i=0}^k a_i b_{k-i} + \sum_{i=k+1}^{n-1} a_i b_{n+k-i} \bmod q\quad (k = 0, 1, \dots, n - 1).
    $$
    
    And $\boldsymbol{c}$ is referred to as the cyclic convolution (CC for short) of $\boldsymbol{a}$ and $\boldsymbol{b}$.
    

- **Negative wrapped** convolution
    
    Consider $\boldsymbol{c} = \boldsymbol{a} \cdot \boldsymbol{b} \in \mathbb{Z}_q[x]/(x^n + 1)$, then 
    
    $$
    \boldsymbol c = \sum_{k=0}^{n-1} c_k x^k,\\[.5em] 
    \text{where } c_k = \sum_{i=0}^k a_i b_{k-i} - \sum_{i=k+1}^{n-1} a_i b_{n+k-i} \bmod q \quad (k = 0, 1, \dots, n - 1). 
    $$
    
    Here, $\boldsymbol{c}$ is referred to as their negative wrapped convolution (NWC for short).
    
    â€»  $x^{n+k} = x^n \cdot x^k \equiv \mathbf{(-1)} \cdot x^k = -x^k$
    

### NTT

#### Cyclic Convolution-based NTT

$n$-point CC-based NTT has two parameters.

- The length or the point $n$, where $n$ is a power of two.
- The modulus $q$, where $q$ is a prime number satisfying $q \equiv 1 \pmod n$.

- It implies that the primitive $n$-th root of unity $\omega_n$ in $\mathbb{Z}_q$ exists.
    
    $\mathbb{Z}_q$ê°€ ì†Œìˆ˜ $q$ì— ëŒ€í•œ Fieldì´ë¯€ë¡œ, 
    
    0ì„ ì œì™¸í•œ ê³±ì…ˆêµ° $\mathbb{Z}_q^* = {1, 2, \dots, q-1}$ì€ order$\,=q-1$ì¸ groupì´ë‹¤. 
    
    $\mathbb{Z}_q$ì˜ ê³±ì…ˆêµ° $\mathbb{Z}_q^*$ëŠ” í•­ìƒ cyclic groupì´ë¯€ë¡œ, 
    
    ì–´ë–¤ generator $g$ê°€ ì¡´ì¬í•˜ì—¬ $\mathbb{Z}_q^* = \{ g^1, g^2, \dots, g^{q-1} \}$ì´ë‹¤. 
    
    ì´ë•Œ $q \equiv 1 \pmod n$ì´ë¯€ë¡œ $n \mid (q-1)$ì´ê³ , 
    
    ë”°ë¼ì„œ $\mathbb{Z}_q$ì—ëŠ” order$\,=n$ì¸ cyclic subgroupì˜ generatorê°€ ì¡´ì¬í•œë‹¤.
    
    order$\,=n$ì¸ $x\in\mathbb{Z}_q$ëŠ” ë‹¤ìŒì„ ë§Œì¡±í•œë‹¤.
    
    - $x^n \equiv 1 \pmod q$
    - $0 < k < n$ ì¸ ëª¨ë“  $k$ì— ëŒ€í•´ $x^k \not\equiv 1 \pmod q$
    
    ì¦‰, $x$ëŠ” primitive $n$-th root of unityì´ë‹¤.
    
    ë”°ë¼ì„œ ì†Œìˆ˜ $q$ì— ëŒ€í•´ $q \equiv 1 \pmod n$ì´ë¼ë©´, $\mathbb{Z}_q$ì—ëŠ” primitive $n$-th root of unity **$\omega_n$**ê°€ ì¡´ì¬í•˜ë©°, 
    
    íŠ¹íˆ, $\phi(n)$ê°œë§Œí¼ ì¡´ì¬í•œë‹¤.
    

The forward transform, denoted by NTT, is defined as: $\hat{\boldsymbol{a}} = \text{NTT}(\boldsymbol{a})$, where

$$
\hat{a}_j = \sum_{i=0}^{n-1} a_i \omega_n^{ij} \bmod q \quad (j = 0, 1, \dots, n - 1).
$$

- NTTì˜ matrix í‘œí˜„
    
    $$
    NTT=\begin{bmatrix}
    \omega^{0\times0} &\cdots & \omega^{0\times j} &\cdots& \omega^{0\times(n-1)}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\
    \omega^{i\times0} &\cdots & \omega^{i\times j} &\cdots& \omega^{i\times(n-1)}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\
    \omega^{(n-1)\times0} &\cdots & \omega^{(n-1)\times j} &\cdots& \omega^{(n-1)\times(n-1)}\\
    \end{bmatrix}
    $$
    

The inverse transform, denoted by INTT, is defined as $\boldsymbol{a} = \text{INTT}(\hat{\boldsymbol{a}})$, where

$$
a_i = n^{-1} \sum_{j=0}^{n-1} \hat{a}_j \omega_n^{-ij} \bmod q \quad (i = 0, 1, \dots, n - 1).
$$

- INTTì˜ matrix í‘œí˜„
    
    $$
    \begin{aligned}
    NTT^{-1}&=\frac{1}{n}\begin{bmatrix}
    \;\omega^{-[0\times0]} &\cdots & \omega^{-[0\times j]} &\cdots& \omega^{-[0\times(n-1)]}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\[.5em]
    \;\omega^{-[i\times0]} &\cdots & \omega^{-[i\times j]} &\cdots& \omega^{-[i\times(n-1)]}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\[.5em]
    \;\omega^{-[(n-1)\times0]} &\;\;\cdots\;\; & \omega^{-[(n-1)\times j]} &\cdots& \omega^{-[(n-1)\times(n-1)]}\;
    \end{bmatrix}\\
    & =\frac{1}{n}\begin{bmatrix}
    \omega^{[0\times0] + (n/2)} &\cdots & \omega^{[0\times j] + (n/2)} &\cdots& \omega^{[0\times(n-1)] + (n/2)}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\[.5em]
    \omega^{[i\times0] + (n/2)} &\cdots & \omega^{[i\times j] + (n/2)} &\cdots& \omega^{[i\times(n-1)] + (n/2)}\\
    \vdots & \ddots & \vdots & \ddots & \vdots \\[.5em]
    \omega^{[(n-1)\times0] + (n/2)} \!\!\!\!&\cdots & \!\!\!\!\omega^{[(n-1)\times j] + (n/2)} \!\!\!\!&\cdots&\!\!\!\! \omega^{[(n-1)\times(n-1)] + (n/2)}\\
    \end{bmatrix}
    \end{aligned}
    $$
    

Note that the inverse transform can be implemented by replacing the $\omega_n$ in NTT procedure with $\omega_n^{-1}$, followed by multiplying by a scale factor $n^{-1}$. 

##### Prop) Cyclic Convolution Property

Let $\boldsymbol{c}$ be the cyclic convolution of $\boldsymbol{a}$ and $\boldsymbol{b}$, then it holds that

$$
\text{NTT}(\boldsymbol{c}) = \text{NTT}(\boldsymbol{a}\cdot\boldsymbol{b}) = \text{NTT}(\boldsymbol{a}) \circ \text{NTT}(\boldsymbol{b}).
$$

#### Negative Wrapped Convolution-based NTT

The modulus $q$ is set to be a prime number satisfying $q \equiv 1 \pmod{2n}$ such that 

- the primitive $2n$-th root of unity $\psi_{2n}$ in $\mathbb{Z}_q$ exists.
    
    [ì™œ $2n$-th root of unityë¥¼ êµ¬í•˜ëŠ”ê°€?]
    
    Negative Wrapped Convolutionì€ $\mathbb{Z}_q[x]/(x^n+1)$ì—ì„œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë¯€ë¡œ $x^n \equiv -1$ê°€ ë˜ëŠ” $x$ë¥¼ êµ¬í•´ì•¼ í•œë‹¤. 
    
    `n-th primitive roots of unityëŠ” x^n=1ì´ë¯€ë¡œ êµ¬í•˜ê³ ì í•˜ëŠ” ê·¼ì´ ì•„ë‹˜`
    
    ì´ë•Œ $x$ëŠ” $x^{2n} \equiv 1$ì´ë¯€ë¡œ  $q \equiv 1 \pmod{2n}$ë¡œ ì„¤ì •í•˜ë©´,
    
    $(\psi_{2n}^{n})^2\equiv 1\implies
    \psi_{2n}^{n}\equiv -1$ì¸ primitive $2n$-th root of unity $\psi_{2n}\in\mathbb{Z}_q$ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤.
    
    ì´ë•Œ, $\psi_{2n}$ëŠ” primitiveì´ë¯€ë¡œ $k<2n$ì— ëŒ€í•˜ì—¬ $\psi_{2n}^k\neq 1$ì´ë¯€ë¡œ $\psi_{2n}^n\equiv1$ì´ë‹¤.
    
    â€»  $\mathbb{Z}_q[x]/(x^{2n}-1)$ì˜ primitive $2n$-th roots of unity $\psi_{2n}$
    
    ì¤‘êµ­ì¸ì˜ ë‚˜ë¨¸ì§€ ì •ë¦¬ì— ì˜í•´
    
    $$
    \mathbb{Z}_q[x]/(x^{2n}-1) \;\cong\; \underbrace{\,\mathbb{Z}_q[x]/(x^n-1)}_{\text{Cyclic Convolution}} \;\times \; \underbrace{\,\mathbb{Z}_q[x]/(x^n+1)}_{\text{Negative Wrapped}}
    $$
    
    ì´ê³ , $\mathbb{Z}_q[x]/(x^{2n}-1)$ì—ì„œ êµ¬í•œ $2n$ê°œ ê·¼ì€ $\{ \psi_{2n}^0, \psi_{2n}^1, \psi_{2n}^2, \dots, \psi_{2n}^{2n-1} \}$ì´ë‹¤.
    
    ì´ë•Œ, $k=0,1,\,...\,,n-1$ì— ëŒ€í•˜ì—¬ $\psi_{2n}^{2k}$ëŠ”
    
    $$
    (\psi_{2n}^{2k})^n = (\psi_{2n}^{2n})^k = 1^k = 1
    $$
    
    ì´ë¯€ë¡œ $\mathbb{Z}_q[x]/(x^n-1)$ì˜ ê·¼ì´ ë˜ê³ , $\psi_{2n}^{2k+1}$ì€
    
    $$
    (\psi_{2n}^{2k+1})^n = (\psi_{2n}^{2n})^k \cdot \psi_{2n}^n = 1 \cdot (-1) = -1
    $$
    
    ì´ë¯€ë¡œ $\mathbb{Z}_q[x]/(x^n+1)$ì˜ ê·¼ì´ ëœë‹¤.
    

Take $\omega_n = \psi_{2n}^2 \bmod q$, and write 

$$
\boldsymbol{\psi} = (1, \psi_{2n}, \psi_{2n}^2, \dots, \psi_{2n}^{n-1}),\quad 
\boldsymbol{\psi}^{-1} = (1, \psi_{2n}^{-1}, \psi_{2n}^{-2}, \dots, \psi_{2n}^{-(n-1)}). 
$$

Define 

$$
\bar{\boldsymbol{a}} = \boldsymbol{\psi} \circ \boldsymbol{a},\text{ where } \bar{a}_i = \psi_{2n}^i a_i \\[.5em]
\boldsymbol{a} = \boldsymbol{\psi}^{-1} \circ \bar{\boldsymbol{a}},\text{ where } a_i = \psi_{2n}^{-i} \bar{a}_i. 
$$

$$
\hat{\boldsymbol{a}} = \text{NTT}^\psi(\boldsymbol{a}) = \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{a}),\\[1em]
\boldsymbol{a} = \text{INTT}^{\psi^{-1}}(\hat{\boldsymbol{a}}) = \boldsymbol{\psi}^{-1} \circ \text{INTT}(\hat{\boldsymbol{a}}).
$$

`matrix í‘œí˜„ì€ CCì™€ ë™ì¼ (psiê°€ ì•„ë‹Œ omega ì‚¬ìš©)`

More specifically, the forward transform $\hat{\boldsymbol{a}} = \text{NTT}^\psi(\boldsymbol{a})$ can be written as

$$
\hat{a}_j = \sum_{i=0}^{n-1} a_i \psi_{2n}^i \omega_n^{ij} \bmod q \quad (j = 0, 1, \dots, n - 1).
$$

The inverse transform $\boldsymbol{a} = \text{INTT}^{\psi^{-1}}(\hat{\boldsymbol{a}})$ can be written as

$$
a_i = n^{-1} \psi_{2n}^{-i} \sum_{j=0}^{n-1} \hat{a}_j \omega_n^{-ij} \bmod q \quad (i = 0, 1, \dots, n - 1).
$$

##### Prop) Negative Wrapped Convolution Property

Let $\boldsymbol{c}$ be the negative wrapped convolution of $\boldsymbol{a}$ and $\boldsymbol{b}$, then it holds that

$$
\begin{aligned}
\text{NTT}^\psi(\boldsymbol{c}) 
& = \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{c})\\[.3em]
&=\text{NTT}(\boldsymbol{\psi} \circ (\underbrace{\boldsymbol{a}\cdot\boldsymbol{b}}_\text{NWC}))\\[.3em]
&=\text{NTT}(\underbrace{(\boldsymbol{\psi} \circ\boldsymbol{a})\cdot (\boldsymbol{\psi} \circ\boldsymbol{b})}_{\text{CC\; }\because\ \psi_{wn}^{2k+1}\,\to\ \psi_{wn}^{2k+2}})\\[.3em]
&=\text{NTT}(\boldsymbol{\psi} \circ\boldsymbol{a})\circ\text{NTT}(\boldsymbol{\psi} \circ\boldsymbol{b})\\[.3em]
&=\text{NTT}^\psi(\boldsymbol{a}) \circ \text{NTT}^\psi(\boldsymbol{b}).
\end{aligned}
$$

- Example
    
    **Initialization**
    
    - $\mathbb{Z}_q[x]/(x^n+1)$
        - $n=2$, modulus $x^2 + 1$ (ì¦‰, $x^2 \equiv -1$)
        - $q=5$ ($q \equiv 1 \pmod{2n}$ ë§Œì¡±)
    - $\psi=2$
        
        $2^1=2,\; 2^2=4,\; 2^3=8\equiv3,\; 2^4=16\equiv1$, $\psi^n \equiv -1 \pmod q$
        
    - $\omega=4$
    - NTT matrix $N = \begin{bmatrix} 1 & 1 \\ 1 & \omega \end{bmatrix} = \begin{bmatrix} 1 & 1 \\ 1 & 4 \end{bmatrix}$
    - $\boldsymbol{a} = [1, 1]$ (ì¦‰, $x+1$)
    - $\boldsymbol{b} = [2, 1]$ (ì¦‰, $x+2$)
    
    **Calculation** (ë²¡í„°í‘œí˜„ê³¼ ë§ì¶”ê¸° ìœ„í•´ ë‹¤í•­ì‹ì„ ì €ì°¨í•­ë¶€í„° í‘œê¸°)
    
    $\boldsymbol{\psi}=[ \psi^0, \psi^1 ] = [1, 2]$
    
    1. $\text{NTT}^\psi(\boldsymbol{c})
    :=\text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{c})=\text{NTT}(\boldsymbol{\psi} \circ (\boldsymbol{a}\cdot\boldsymbol{b}))$
        
        $\boldsymbol{c}=(1+x)(2+x) = 2 + 3x + x^2\equiv 2 + 3x + (-1) = 1+3x \implies[1,3]$
        
        $\boldsymbol{\psi} \circ \boldsymbol{c}=[1,2]\circ[1,3]=[1,6]\equiv[1,1]$
        
        $$
        \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{c})=N([1,1])=\begin{bmatrix} 1 & 1 \\ 1 & 4 \end{bmatrix}\begin{bmatrix} 1 \\ 1 \end{bmatrix}=\begin{bmatrix} 2 \\ 5 \end{bmatrix}\equiv\begin{bmatrix} 2 \\ 0 \end{bmatrix}=[2,0]
        $$
        
        $\boldsymbol{a}\cdot \boldsymbol{b}=\boldsymbol{c}=[1,3]$
        
        $\text{NTT}(\boldsymbol{\psi} \circ (\boldsymbol{a}\cdot \boldsymbol{b}))=[2,0]$
        
    2. $\text{NTT}((\boldsymbol{\psi} \circ\boldsymbol{a})\cdot (\boldsymbol{\psi} \circ\boldsymbol{b}))$
        
        â€» $\boldsymbol{\psi}$ë¥¼ ê³±í•´ì¤¬ê¸° ë•Œë¬¸ì— Cyclic convolution ê³µê°„ì´ ë¨ â‡’ $x^2\equiv 1$
        
        $\boldsymbol{\psi} \circ \boldsymbol{a}=[1,2]\circ[1,1]=[1,2]\implies1+2x$
        
        $\boldsymbol{\psi} \circ \boldsymbol{b}=[1,2]\circ[2,1]=[2,2]\implies 2+2x$
        
        $$
        \begin{aligned}
        (\boldsymbol{\psi} \circ\boldsymbol{a})\cdot (\boldsymbol{\psi} \circ\boldsymbol{b})
        &=(1+2x)(2+2x)=2+4x+2x+4x^2\\
        &=2+6x+4(1)=6+6x\\
        &\equiv 1+x\implies [1,1]
        \end{aligned}
        $$
        
        $$
        \text{NTT}((\boldsymbol{\psi} \circ\boldsymbol{a})\cdot (\boldsymbol{\psi} \circ\boldsymbol{b}))=N([1,1])=\begin{bmatrix} 1 & 1 \\ 1 & 4 \end{bmatrix}\begin{bmatrix} 1 \\ 1 \end{bmatrix}=\begin{bmatrix} 2 \\ 5 \end{bmatrix}\equiv\begin{bmatrix} 2 \\ 0 \end{bmatrix}=[2,0]
        $$
        
    3. $\text{NTT}(\boldsymbol{\psi} \circ\boldsymbol{a})\circ\text{NTT}(\boldsymbol{\psi} \circ\boldsymbol{b}) := \text{NTT}^\psi(\boldsymbol{a}) \circ \text{NTT}^\psi(\boldsymbol{b})$
        
        $$
        \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{a})=N([1,2])=\begin{bmatrix} 1 & 1 \\ 1 & 4 \end{bmatrix}\begin{bmatrix} 1 \\ 2 \end{bmatrix}=\begin{bmatrix} 3 \\ 9 \end{bmatrix}\equiv\begin{bmatrix} 3 \\ 4 \end{bmatrix}=[3,4]
        $$
        
        $$
        \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{b})=N([2,2])=\begin{bmatrix} 1 & 1 \\ 1 & 4 \end{bmatrix}\begin{bmatrix} 2 \\ 2 \end{bmatrix}=\begin{bmatrix} 4 \\ 10 \end{bmatrix}\equiv\begin{bmatrix} 4 \\ 0 \end{bmatrix}=[4,0]
        $$
        
        $$
        \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{a})\circ \text{NTT}(\boldsymbol{\psi} \circ \boldsymbol{b})=[3,4]\circ[4,0]=[12,0]=[2,0]
        $$
        

#### NTT-based Polynomial Multiplication

##### Cyclic convolution-based polynomial multiplication

To compute the cyclic convolution $\boldsymbol{c} = \boldsymbol{a} \cdot \boldsymbol{b} \in \mathbb{Z}_q[x]/(x^n - 1)$, 

one can straightly use $n$-point NTT/INTT, according to cyclic convolution property

$$
\boldsymbol{c} = \text{INTT}(\text{NTT}(\boldsymbol{a}) \circ \text{NTT}(\boldsymbol{b})).
$$

##### Negative wrapped convolution-based polynomial multiplication

To compute the negative wrapped convolution $\boldsymbol{c} = \boldsymbol{a} \cdot \boldsymbol{b} \in \mathbb{Z}_q[x]/(x^n + 1)$, one can use the negative wrapped convolution property

$$
\boldsymbol{c} = \text{INTT}^{\psi^{-1}}\left(\text{NTT}^\psi(\boldsymbol{a}) \circ \text{NTT}^\psi(\boldsymbol{b})\right).
$$

##### Advantages of NTT

Here, let NTT/INTT be any kind of forward/inverse transforms.

- Firstly, both NTT and INTT are linear transformations, based on which INTTs can be saved in lattice-based schemes (e.g., Kyber and Dilithium), i.e.,
    
    $$
    \begin{aligned}
    \sum_{i=0}^l \boldsymbol{a}_i \boldsymbol{b}_i 
    &= \sum_{i=0}^l \text{INTT}(\text{NTT}(\boldsymbol{a}_i) \circ \text{NTT}(\boldsymbol{b}_i)) \\
    &= \text{INTT}(\sum_{i=0}^l \text{NTT}(\boldsymbol{a}_i) \circ \text{NTT}(\boldsymbol{b}_i)).
    \end{aligned}
    $$
    

#### FFT Trick for NWC-based NTT over $\mathbb{Z}_q[x]/(x^n + 1)$

The FFT trick to compute $\text{NTT}^\psi$ and $\text{INTT}^{\psi^{-1}}$ over $\mathbb{Z}_q[x]/(x^n + 1)$, 

where $n$ is a power of two and $q$ is a prime number satisfying $q \equiv 1 \pmod{2n}$. 

Since $\psi_{2n}^{n/2} \equiv -1 \pmod q$, 

$$
â. 
$$

As for $\text{NTT}^\psi$, the forward FFT trick implies that we have the following isomorphism

$$
\mathbb{Z}_q[x]/(x^n + 1) \;\cong\; \mathbb{Z}_q[x]/(x^{n/2} - \psi_{2n}^{n/2}) \times \mathbb{Z}_q[x]/(x^{n/2} + \psi_{2n}^{n/2})
$$

Notice that $x^n + 1$ has $n$ distinct roots in $\mathbb{Z}_q$, i.e., $\psi_{2n}^{2i+1}, i = 0, 1, \dots, n-1$.

Therefore, there is a CRT isomorphism similarly.

$$
\mathbb{Z}_q[x]/(x^n + 1) \;\cong\; \prod_{i=0}^{n-1} \mathbb{Z}_q[x]/(x - \psi_{2n}^{2\text{brv}_n(i)+1}).
$$

![image]({{ '/assets/img/post/ntt_ml_kem/image.png' | relative_url }})
<!-- ![image.png](image.png) -->

After the $k$-th level, where $0 \le k < \log n$, it produces 

$$
\qquad\mathbb{Z}_q[x]/(x^{n/2^{k+1}} \pm \psi_{2n}^{\text{brv}_n(2^k+i)})
$$

with pairs of rings. 

##### Example

$n=8 \Rightarrow 2n=16$

Let $\psi_{2n}$ is a primitive $2n$-th root of unity: i.e., $\psi_{2n}^{2n}=1$

![image]({{ '/assets/img/post/ntt_ml_kem/image_1.png' | relative_url }})
<!-- ![image.png](image%201.png) -->

Let $\omega=\psi_{2n}^2$, then $\omega$ is a primitive $n$-th root of unity: $\omega^{n}= (\psi_{2n}^2)^{n}=1$

![image]({{ '/assets/img/post/ntt_ml_kem/image_2.png' | relative_url }})
<!-- ![image.png](image%202.png) -->

![image]({{ '/assets/img/post/ntt_ml_kem/image_3.png' | relative_url }})
<!-- ![image.png](image%203.png) -->

#### Radix-2 Fast NWC-based NTT

The Cooley-Tukey butterfly or CT butterfly`Multiplication â†’ Addition`. 

![image]({{ '/assets/img/post/ntt_ml_kem/14416731-2c31-4e01-9c81-ca220167df77.png' | relative_url }})
<!-- ![image.png](14416731-2c31-4e01-9c81-ca220167df77.png) -->

Gentlemen-Sande butterfly or GS butterfly`Addition â†’ Multiplication`. 

![image]({{ '/assets/img/post/ntt_ml_kem/bc9e4c46-c1a8-4888-8f28-8fab825d7c10.png' | relative_url }})
<!-- ![image.png](bc9e4c46-c1a8-4888-8f28-8fab825d7c10.png) -->

The process of multiplying the coefficients by $\psi_{2n}^i$ before forward transform is referred to as pre-processing.

![image]({{ '/assets/img/post/ntt_ml_kem/image_4.png' | relative_url }})
<!-- ![image.png](image%204.png) -->

![image]({{ '/assets/img/post/ntt_ml_kem/image_5.png' | relative_url }})
<!-- ![image.png](image%205.png) -->

1. **Cooley-Tukey algorithm for $\text{NTT}^\psi$**
    
    According to the definition of $\text{NTT}^\psi$, the coefficients of $\hat{\boldsymbol{a}}$ can be written as
    
    $$
    \hat{a}_j = \sum_{i=0}^{n-1} a_i \psi_{2n}^i \omega_n^{ij} \bmod q, \quad j = 0, 1, \dots, n - 1.
    $$
    
    For $j = 0, 1, \dots, n - 1$,
    
    $$
    \begin{aligned}
    \hat{a}_j &= \sum_{i=0}^{n/2-1} a_{2i} \omega_n^{2ij} \psi_{2n}^{2i} + \sum_{i=0}^{n/2-1} a_{2i+1} \omega_n^{(2i+1)j} \psi_{2n}^{2i+1} \bmod q \\[1.5em]
    &= \sum_{i=0}^{n/2-1} a_{2i} (\omega_n^2)^{ij} (\psi_{2n}^2)^i + \omega_n^j \psi_{2n} \sum_{i=0}^{n/2-1} a_{2i+1} (\omega_n^2)^{ij} (\psi_{2n}^2)^i \bmod q.
    \end{aligned}
    $$
    
    Based on the periodicity and symmetry of the primitive root of unity, for $j = 0, 1, \dots, n/2 - 1$
    
    $$
    \begin{aligned}
    \hat{a}_j &= \sum_{i=0}^{n/2-1} a_{2i} (\omega_n^2)^{ij} (\psi_{2n}^2)^i + \omega_n^j \psi_{2n} \sum_{i=0}^{n/2-1} a_{2i+1} (\omega_n^2)^{ij} (\psi_{2n}^2)^i \bmod q \\[1.5em]
    \hat{a}_{j+n/2} &= \sum_{i=0}^{n/2-1} a_{2i} (\omega_n^2)^{ij} (\psi_{2n}^2)^i - \omega_n^j \psi_{2n} \sum_{i=0}^{n/2-1} a_{2i+1} (\omega_n^2)^{ij} (\psi_{2n}^2)^i \bmod q. 
    \end{aligned}
    $$
    
    Let 
    
    $$
    \begin{aligned}
    \hat{a}'_j &= \sum_{i=0}^{n/2-1} a_{2i} (\omega_n^2)^{ij} (\psi_{2n}^2)^i \bmod q,\\[1.5em]
    \hat{a}''_j &= \sum_{i=0}^{n/2-1} a_{2i+1} (\omega_n^2)^{ij} (\psi_{2n}^2)^i \bmod q.
    \end{aligned}
    $$
    
    With $\omega_n^j \psi_{2n} = \psi_{2n}^{2j+1}$, 
    
    $$
    \hat{a}_j = \hat{a}'_j + \psi_{2n}^{2j+1} \hat{a}''_j \bmod q, \quad \hat{a}_{j+n/2} = \hat{a}'_j - \psi_{2n}^{2j+1} \hat{a}''_j \bmod q. 
    $$
    
    One can see that, $\hat{a}'_j$ and $\hat{a}''_j$ can be obtained via exact $n/2$-point $\text{NTT}^\psi$s. 
    
2. **Gentleman-Sande algorithm for $\text{INTT}^{\psi^{-1}}$**
    
    According to the definition of $\text{INTT}^{\psi^{-1}}$, the coefficients of $\boldsymbol{a}$ can be written as
    
    $$
    a_i = n^{-1} \psi_{2n}^{-i} \sum_{j=0}^{n-1} \hat{a}_j \omega_n^{-ij} \bmod q, \quad i = 0, 1, \dots, n - 1. 
    $$
    
    With neglecting $n^{-1}$, for $i = 0, 1, \dots, n - 1$,
    
    $$
    \begin{aligned}
    a_i &= \psi_{2n}^{-i} \left( \sum_{j=0}^{n/2-1} \hat{a}_j \omega_n^{-ij} + \sum_{j=n/2}^{n-1} \hat{a}_j \omega_n^{-ij} \right) \\[1.5em]
    &= \psi_{2n}^{-i} \left[ \sum_{j=0}^{n/2-1} \hat{a}_j \omega_n^{-ij} + \sum_{j=0}^{n/2-1} \hat{a}_{j+n/2} \omega_n^{-i(j+n/2)} \right] \bmod q.
    \end{aligned}
    $$
    
    Based on the periodicity and symmetry of the primitive root of unity, for $i = 0, 1, \dots, n/2 - 1$,
    
    $$
    \begin{aligned}
    a_{2i} &= \psi_{2n}^{-2i} \left[ \sum_{j=0}^{n/2-1} \hat{a}_j \omega_n^{-2ij} + (-1)^{2i} \cdot \sum_{j=0}^{n/2-1} \hat{a}_{j+n/2} \omega_n^{-2ij} \right] \bmod q \\[1.5em]
    &= (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} (\hat{a}_j + \hat{a}_{j+n/2}) (\omega_n^2)^{-ij} \bmod q, \\[2em]
    a_{2i+1} &= \psi_{2n}^{-(2i+1)} \left[ \sum_{j=0}^{n/2-1} \hat{a}_j \omega_n^{-(2i+1)j} + (-1)^{2i+1} \cdot \sum_{j=0}^{n/2-1} \hat{a}_{j+n/2} \omega_n^{-(2i+1)j} \right] \bmod q \\[1.5em]
    &= (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} \left[ (\hat{a}_j - \hat{a}_{j+n/2}) \cdot \omega_n^{-j} \psi_{2n}^{-1} \right] (\omega_n^2)^{-ij} \bmod q.
    \end{aligned}
    $$
    
    Since $\omega_n^{-j} \psi_{2n}^{-1} = \psi_{2n}^{-(2j+1)}$, letting 
    
    $$
    \begin{aligned}
    \hat{b}'_j &= \hat{a}_j + \hat{a}_{j+n/2} \bmod q,\\[1em]
     \hat{b}''_j &= (\hat{a}_j - \hat{a}_{j+n/2}) \cdot \psi_{2n}^{-(2j+1)} \bmod q,\quad j = 0, 1, \dots, n/2 - 1, 
    \end{aligned}
    $$
    
    the above formula can be rewritten as, for $i = 0, 1, \dots, n/2 - 1$,
    
    $$
    \begin{aligned}
    a_{2i} &= (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} \hat{b}'_j (\omega_n^2)^{-ij} \bmod q, \\[1.5em]
    a_{2i+1} &= (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} \hat{b}''_j (\omega_n^2)^{-ij} \bmod q. 
    \end{aligned}
    $$
    
    Computing $n$-point $\text{INTT}^{\psi^{-1}}$ can be transformed into two $n/2$-point $\text{INTT}^{\psi^{-1}}$s with respect to $\hat{b}'_j, \hat{b}''_j$. 
    
    Forthermore, $\boldsymbol{\psi}^{-1}$ and $n^{-1}$ can both be integrated into $\text{INTT}^{GS}_{bo \to no}$. 
    
    Thus, for $i = 0, 1, \dots, n/2 - 1$,
    
    $$
    \begin{aligned}
    a_{2i} &= \left(\frac{n}{2}\right)^{\!\!-1}\! (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} \hat{b}'_j (\omega_n^2)^{-ij} \bmod q, \\[1.5em]
    a_{2i+1} &= \left(\frac{n}{2}\right)^{\!\!-1}\! (\psi_{2n}^2)^{-i} \sum_{j=0}^{n/2-1} \hat{b}''_j (\omega_n^2)^{-ij} \bmod q, 
    \end{aligned}\\[.7em]
    \begin{aligned}
    \text{where }\; &
    \hat{b}'_j = (\hat{a}_j + \hat{a}_{j+n/2})/2 \mod q,\\[.5em]& 
    \hat{b}''_j = (\hat{a}_j - \hat{a}_{j+n/2})/2 \cdot \psi_{2n}^{-(2j+1)} \bmod q, \quad 
    j = 0, 1, \dots, n/2 - 1.
    \end{aligned}
    $$
    

### Kyber NTT

<aside>
ğŸ’¡

1. Kyber ringì€ $\mathbb{Z}_q[x]/(x^n+1)$ì´ë¯€ë¡œ NWC-based NTTë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ primitive $2n$-th root of unityê°€ í•„ìš”í•¨
    - $2n$-th root of unity $\psi_{2n}$ëŠ” $\psi_{2n}^{2n}=1$ì´ë¯€ë¡œ
        
        $\psi_{2n}^n=-1\implies x^n+1=x^n-(\psi_{2n}^n)=0$ì„ ë§Œì¡±í•¨
        
2. Primitive $2n$-th root of unityê°€ ì¡´ì¬í•˜ë ¤ë©´
    1. $n=2^k$
    2. $q\equiv 1\pmod{2n}$
    
    ì„ ë§Œì¡±í•´ì•¼ í•¨
    
3. KyberëŠ” $n=256=2^8$ì´ì§€ë§Œ $q$ì— ëŒ€í•˜ì—¬ $q\equiv 257\neq 1\pmod{512}$ì´ë¯€ë¡œ $2n$-th root of unityê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
4. Kyber ring $\mathbb{Z}_q[x]/(x^{256}+1)$ì„ $(\mathbb{Z}_q[y]/(y^2-x))[x]/(x^{128}+1)$ë¡œ ë³€í™˜í•¨
    1. $n'=128$ì— ëŒ€í•˜ì—¬ primitive $2n$-th root of unityê°€ ì¡´ì¬í•¨
    2. FFTë¥¼ ì ìš©í•œ point-wise multiplicationì€ 
        
        $(c_0 +c_1 y)(c_0' +c_1' y)\in \mathbb{Z}_q[y]/(y^2-x)$ë¡œì¨ ìˆ˜í–‰ë¨
        
</aside>

##### Full NWC-based NTT ì ìš© ë¶ˆê°€

Full NWC-based NTTëŠ” ë‹¤ìŒì„ ë§Œì¡±í•´ì•¼ í•¨

$$
n=2^k\quad\text{ and }\quad q\equiv1\;(\bmod{\;2n})
$$

íŠ¹íˆ, Full NWC-based NTTëŠ”

$$
\mathbb{Z}_q[x]/(x^n + 1) \;\cong\; \prod_{i=0}^{n-1} \mathbb{Z}_q[x]/(x - \psi_{2n}^{2\text{brv}_n(i)+1})
$$

ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì´ë¯€ë¡œ primitive $2n$-th root of unity $\psi_{2n}$ê°€ ì¡´ì¬í•´ì•¼ ì ìš© ê°€ëŠ¥í•¨

Kyberì˜ specì€ ë‹¤ìŒê³¼ ê°™ìŒ

$$
n=256=2^8\quad\text{ and }\quad q\equiv1\;(\bmod{\;256})\quad\text{ but }\quad q\neq 1\;(\bmod{\;512})
$$

ì´ëŠ” $\mathbb{Z}_q$ ìƒì— primitive 256-th root of unityëŠ” ì¡´ì¬í•˜ì§€ë§Œ, primitive 512-th root of unityëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒì„ ì˜ë¯¸

#### Truncated NTTë¥¼ ì´ìš©í•œ í•´ê²°

##### Incomplete FFT trick (Truncated NTT)

Incomplete FFT trickì€ FFT depth level $\beta$ì— ëŒ€í•˜ì—¬ ë‹¤í•­ì‹ ring êµ¬ì¡°ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë³€í™˜í•¨

$$
\mathbb{Z}_q[x]/(x^n+1) \cong \prod_{i=0}^{n/2^\beta - 1} \mathbb{Z}_q[x] / (x^{2^\beta} - \psi_{2n/2^\beta}^{2\text{brv}(i)+1})
$$

- $\beta$ëŠ” $\log n$-levelì˜ NTTë¥¼ $\beta$-level ì´ì „ì— ë§ˆì¹¨ì„ ì˜ë¯¸í•¨

$\beta$ëŠ”

$$
q \equiv 1 \pmod{2n/2^{\beta}}
$$

ë¥¼ ë§Œì¡±í•˜ë„ë¡ ì„ íƒí•˜ë©°, KyberëŠ” íš¨ìœ¨ì„±ì„ ìœ„í•´ ê°€ì¥ ì‘ì€ $\beta=1$ì„ ì„ íƒí•¨

$$
q=3329 \equiv 1\quad(\bmod{\;256}=\bmod{\;{2n}/2})
$$

KyberëŠ” $\beta=1$ì¸ Incomplete FFT trickì„ ì‚¬ìš©í•˜ë¯€ë¡œ

$$
\mathbb{Z}_q[x]/(x^n+1) \cong \prod_{i=0}^{n/2 - 1} \mathbb{Z}_q[x] / (x^{2} - \psi_{n}^{2\text{brv}(i)+1})
$$

ë¡œ ring êµ¬ì¡°ë¥¼ ë³€í™˜í•¨

ì´ëŠ” Kyber ringì—ì„œ ì •ì˜ëœ ë‹¤í•­ì‹ $a(x)\in \mathbb{Z}_q[x]/(x^n+1)$ë¥¼ $y = x^{2^\beta} = x^2$ë¡œ ì¹˜í™˜í•˜ì—¬ $y$ì— ëŒ€í•œ ë‹¤í•­ì‹

$$
\begin{aligned}
a(y) = \sum_{i=0}^{n/2^\beta -1} \tilde{a}_i y^i
&\in \left(\mathbb{Z}_q[x]/(x^{2^\beta} - y)\right)[y]/(y-\psi_{2n/2^\beta}^{2\text{brv}_{n/2^\beta}(i)+1})
\\[1.5em]
\text{ where }\quad
\tilde{a}_i=\sum_{j=0}^{2^\beta -1}a_{2^\beta i+j} x^j &\in \mathbb{Z}_q[x]/(x^{2^\beta} - y)
\end{aligned}
$$

ì¦‰,

$$
\begin{aligned}
a(y) = \sum_{i=0}^{n/2 -1} \tilde{a}_i y^i
&\in \left(\mathbb{Z}_q[x]/(x^{2} - y)\right)[y]/(y-\psi_{n}^{2\text{brv}_{n/2}(i)+1})
\\[1.5em]
\text{ where }\quad
\tilde{a}_i=\sum_{j=0}^{1}a_{2i+j} x^j &\in \mathbb{Z}_q[x]/(x^{2} - y)
\end{aligned}
$$

ë¡œ í‘œí˜„í•¨ì„ ì˜ë¯¸í•¨

ì´ëŠ” 

$$
\mathbb{Z}_q[x]/(x^n+1) \cong \prod_{i=0}^{n/2^\beta - 1} \mathbb{Z}_q[x] / (x^{2^\beta} - \psi_{2n/2^\beta}^{2\text{brv}(i)+1})
$$

ì—ì„œ ìµœìƒìœ„ levelì—ì„œì˜ ring êµ¬ì¡°ë¥¼

$$
\mathbb{Z}_q[x]/(x^n+1) \to \left(\mathbb{Z}_q[x]/(x^{2^\beta} - y)\right)[y]/(y^{n/2^\beta} +1)
$$

ë¡œ ë°”ë¼ë³´ëŠ” ê²ƒì„

$n=256,\ \beta=1$ì— ëŒ€í•˜ì—¬

$$
\mathbb{Z}_q[x]/(x^{256}+1) \to \left(\mathbb{Z}_q[x]/(x^{2} - y)\right)[y]/(y^{128} +1)
$$

ì´ë©°, 

ì´ëŠ” ìµœìƒìœ„ levelì˜ ring êµ¬ì¡°ë¥¼ $y$ì— ëŒ€í•˜ì—¬ ê³„ìˆ˜ê°€ 1ì°¨ ë‹¤í•­ì‹ $c_0+c_1 x$ì¸ 127ì°¨ ë‹¤í•­ì‹ìœ¼ë¡œ ë³´ëŠ” ê²ƒì„

KyberëŠ” ìœ„ êµ¬ì¡°ì—ì„œ $y$ì— ëŒ€í•œ 128-point Full NWC-based NTTë¥¼ ìˆ˜í–‰í•¨

$$
\mathbb{Z}_q[x]/(x^{256}+1) \to \left(\mathbb{Z}_q[x]/(x^{2} - y)\right)[y]/(y^{128} +1)
$$

ë˜í•œ, formal variable $x, y$ë¥¼ êµí™˜í•˜ë©´

$$
\mathbb{Z}_q[x]/(x^{256}+1) \to \left(\mathbb{Z}_q[y]/(y^{2} - x)\right)[x]/(x^{128} +1)
$$

ì´ë¯€ë¡œ, NTTë¥¼ ì ìš©í•  ë‹¤í•­ì‹ì„ $c_0+c_1 y$ í˜•íƒœì˜ ê³„ìˆ˜ë¥¼ ê°–ëŠ” $x$ì— ëŒ€í•œ ë‹¤í•­ì‹ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŒ

ì´ë•Œ $\omega=\psi_{2n/2}=\psi_{n}$ì´ë©°, $\omega_i:=\omega^i$ë¼ê³  í•  ë•Œ ë‹¤í•­ì‹ $\boldsymbol{a}$ëŠ” ë‹¤ìŒìœ¼ë¡œ ë§¤í•‘ë¨

$$
\begin{aligned}
\mathbb{Z}_q[x]/(x^{256}+1) 
&\cong \prod_{i=0}^{127} \mathbb{Z}_q[x] / (x^2 - \omega_i)
\\[1.5em]&\cong 
\prod_{i=0}^{127} 
\left(\mathbb{Z}_q[y]/(y^{2} - x)\right)[x]/ (x^2 - \omega_i)
\end{aligned}
$$

![image]({{ '/assets/img/post/ntt_ml_kem/image_6.png' | relative_url }})
<!-- ![image.png](image%206.png) -->

#### ë‹¤í•­ì‹ ê³±ì…ˆì„ ìœ„í•œ NTT ì„ íƒ

KyberëŠ” NWC-based NTT ì—°ì‚°ì„ ì ìš©í•´ì•¼ í•˜ë¯€ë¡œ 

$$
\text{NTT}^{CT,\psi}_{no\,\to\, bo}\quad\text{ and }\quad\text{INTT}^{GS,\psi^{-1}}_{bo\,\to\, no}
$$

ë¥¼ ì‚¬ìš©í•¨

Point-wise multiplicationì€

$$
a(x), b(x) \in \mathbb{Z}_q[x]/(x^2 - \omega_i)
$$

ì— ëŒ€í•˜ì—¬ (formal variable $y\to x$)

$$
c(x) = a(x)b(x) \pmod{x^2 - \omega_i}
$$

ì„ êµ¬í•˜ëŠ” ê³¼ì •ì´ë©°

$$
\begin{aligned}
(a_0 + a_1x)(b_0 + b_1x) 
&= a_0b_0 + (a_0b_1 + a_1b_0)x + a_1b_1x^2\\
&\equiv (a_0b_0 + a_1b_1\omega^2) + (a_0b_1 + a_1b_0)x \pmod{x^2 - \omega_i}
\end{aligned}
$$

ìœ¼ë¡œ êµ¬í•  ìˆ˜ ìˆìŒ

### Algorithm analysis

##### ${\bf Algorithm} \ \color{#0000ff}{\sf NTT}(f)$

Computes the NTT representation $\hat f$ of the given polynomial $f\in R_q$.

${\bf{Input}}: {\rm array}\ f\in\mathbb{Z}_q^{256}.$

${\bf{Output}}: {\rm array}\ \hat{f}\in\mathbb{Z}_q^{256}.$

$01: \hat{f}\leftarrow f$

$02: i\leftarrow 1$

$03: {\bf for}({\rm len} \leftarrow 128\ ;\ {\rm len}\ge 2\ ;\ {\rm len}/2)$

$04: \quad {\bf for} ({\rm start} \leftarrow 0\ ;\ {\rm start}<256\ ;\ {\rm start}\leftarrow {\rm start}\!+\!2\!\cdot\!{\rm len})$

$05: \qquad {\rm zeta} \leftarrow \zeta^{\color{0000ff} {\sf BitRev}_7(i)} \mod q$

$06: \qquad i\leftarrow i\!+\!1$

$07: \qquad {\bf for} (j\leftarrow {\rm start}\ ;\ j<{\rm start+len}\ ;\ j\text{++})$

$08: \quad\qquad t \leftarrow {\rm zeta}\cdot\hat{f}[j+\rm len]\mod q$

$09: \quad\qquad \hat{f}[j+\rm len] \leftarrow \hat{f}[j]-t\mod q$

$10: \quad\qquad \hat{f}[j] \leftarrow \hat{f}[j]+t\mod q$

$11: \qquad {\bf endfor}$

$12: \quad {\bf endfor}$

$13: {\bf endfor}$

$14: {\bf return}\ \hat{f}$

#### Truncation

- Algorithm line 3: len=128, 64, â€¦ ,2
    
    â‡’  Crops with $\beta=1$
    
    Full NWC-based NTTëŠ” $2^0\sim2^7$ê¹Œì§€ $\log 2^8=8$-levelì˜ NTTë¥¼ ìˆ˜í–‰í•˜ì§€ë§Œ
    
    KyberëŠ” $\beta=1$-levelì¸ $\text{len}=2^0$ì— ëŒ€í•œ ë¶„í•´ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ
    
- Line 8~10
    
    â‡’  Point-wise multiplication over $\mathbb{Z}_q[x]/(x^2-\zeta)$ for $\zeta=\omega_i$
    
    $$
    \left(\ \sum_{i=0}^{1} \hat{a}_i x^i\right)\left(\ \sum_{i=0}^{1} \hat{b}_i x^i\right) 
    =(\hat{a}_0 x^0+\hat{a}_1 x^1)(\hat{b}_0 x^0+\hat{b}_1 x^1)
    \mod({x^{2} - \zeta}), 
    $$